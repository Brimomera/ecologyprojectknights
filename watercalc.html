<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Consumption Calculator | EcoTech</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS configuration for custom font families
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        roboto: ['Roboto', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Combined CSS from previous calculators and adapted for this one */
        :root {
            --primary: #7c3aed;
            --primary-dark: #5b21b6;
            --accent: #38bdf8;
            --text: #5b21b6; /* Changed to purple for light theme */
            --background: #f3f4f6;
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-dark: rgba(30, 50, 30, 0.25);
            --footer-bg: #ede9fe;
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --border-radius: 18px;
            --olive-light: #6B8E23;
            --olive-dark: #556B2F;
            --olive-darker: #4A5C2A;
            --light-button: rgb(165, 141, 238);
            --dark-button: rgba(42, 77, 64, 0.7);
            --neon-blue: rgba(56, 189, 248, 0.8);
            --neon-purple: rgba(124, 58, 237, 0.8);
            --neon-green: rgba(107, 142, 35, 0.8);
            --neon-yellow: rgba(255, 255, 0, 0.8);
            --chart-glow-color: rgba(124, 58, 237, 0.6);
        }
        body.dark {
            --text: #A7D9B9; /* Changed to green for dark theme */
            --background: #18181b;
            --footer-bg: #2a2636;
            background: linear-gradient(135deg, #2a4d40 0%, #21382b 50%, #18181b 100%);
            background-size: 200% 200%;
            animation: gradient 12s ease-in-out infinite;
            --light-button: rgb(165, 141, 238);
            --dark-button: rgba(42, 77, 64, 0.7);
            --chart-glow-color: rgba(56, 189, 248, 0.6);
        }
        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        body {
            margin: 0;
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #d0bfff 0%, #a78bfa 50%, #f3e8ff 100%);
            background-size: 200% 200%;
            animation: gradient 12s ease-in-out infinite;
            color: var(--text); /* Uses the --text variable */
            display: flex; /* Use flexbox for body */
            flex-direction: row; /* Sidebar and content wrapper side-by-side */
            min-height: 100vh;
            transition: background-color 0.5s ease, color 0.5s ease;
            overflow-x: hidden;
        }

        /* Sidebar Navigation Styles */
        .nav__cont {
            position: sticky; /* Sticky positioning to keep it in place */
            top: 0;
            left: 0;
            height: 100vh;
            width: 60px; /* Default collapsed width */
            background-color: rgba(32, 32, 32, 0.3);
            backdrop-filter: blur(10px);
            overflow-x: hidden; /* Hide horizontal scroll */
            overflow-y: auto; /* Make vertical scrollable */
            transition: width 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            box-shadow: 4px 7px 10px rgba(0, 0, 0, 0.4);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 1.5rem;
            flex-shrink: 0; /* Prevent it from shrinking */
        }

        .nav__cont:hover {
            width: 200px; /* Expanded width on hover */
        }

        body.dark .nav__cont {
            background: var(--glass-dark);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .nav {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
            color: var(--text); /* Uses the --text variable */
        }

        .nav__items {
            padding: 1.2rem 0;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: background-color 0.3s ease;
            width: 100%;
            justify-content: center; /* Center content when collapsed */
        }

        .nav__items:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .nav__items a {
            color: var(--text); /* Uses the --text variable */
            font-size: 0.95rem;
            font-weight: 400;
            text-decoration: none;
            margin-left: 0; /* No initial margin-left */
            opacity: 0; /* Hide text initially */
            white-space: nowrap;
            transition: opacity 0.3s ease, color 0.3s ease;
            visibility: hidden;
            display: flex;
            align-items: center;
            padding-left: 20px; /* Padding for text when expanded */
            width: 100%;
        }
        .nav__items a::before { /* Icon styling */
            content: attr(data-icon);
            font-size: 1.2rem;
            margin-right: 15px;
            opacity: 1; /* Always visible */
            visibility: visible; /* Always visible */
            transition: margin-right 0.3s ease;
        }

        .nav__cont:hover .nav__items a { /* Show text and align left on hover */
            opacity: 1;
            visibility: visible;
            justify-content: flex-start;
        }
        .nav__cont:hover .nav__items a::before {
            margin-right: 15px; /* Ensure space between icon and text */
        }

        /* Content Wrapper for Centering */
        #contentWrapper {
            flex-grow: 1; /* Allows content to take remaining space */
            display: flex;
            flex-direction: column;
            align-items: center; /* Center items horizontally within the wrapper */
            padding: 20px;
            transition: margin-left 0.3s ease; /* For potential future dynamic margins if needed */
        }

        /* Header styles - now centered within contentWrapper */
        header {
            text-align: center;
            padding: 30px 20px 50px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin: 32px auto 24px auto; /* Centered horizontally with auto margins */
            max-width: 900px; /* Max width for header content */
            width: 100%; /* Take full width up to max-width */
            color: var(--primary-dark);
            transition: background 0.4s ease, color 0.4s ease, transform 0.2s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        header:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        h1 {
            font-family: 'Roboto', sans-serif;
            font-size: 3rem;
            color: var(--text); /* Uses the --text variable */
            margin: 10px 0 0 0;
            letter-spacing: 3px;
            animation: dropIn 1s ease;
            transform-origin: top;
        }
        @keyframes dropIn {
            from {
                transform: translateY(-50px) scaleY(0);
                opacity: 0;
            }
            to {
                transform: translateY(0) scaleY(1);
                opacity: 1;
            }
        }

        .logo {
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
            transition: transform 0.3s ease;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 15px var(--accent);
        }

        .logo:hover {
            transform: scale(1.08) rotate(5deg);
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--light-button);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-size: 1.5rem;
        }

        body.dark .theme-toggle {
            background: var(--dark-button);
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .theme-toggle-icon {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover .theme-toggle-icon {
            transform: rotate(30deg);
        }

        main {
            flex: 1; /* Allows main to grow and push footer down */
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content within main */
            padding: 0 20px; /* Adjust padding to leave space for centering */
            margin: 20px auto; /* Centered horizontally with auto margins */
            max-width: 900px; /* Max width for main content area */
            width: 100%;
        }

        section {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin: 0 auto 30px auto; /* Explicitly center horizontally with auto margins */
            width: 100%;
            max-width: 800px; /* Section specific max-width for internal content */
            text-align: center;
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
            opacity: 0;
            transform: translateY(20px);
        }

        section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        h2 {
            font-family: 'Roboto', sans-serif;
            font-size: 2.5rem;
            color: var(--text); /* Changed to use --text variable */
            margin-bottom: 25px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text); /* Uses the --text variable */
            font-size: 1.1rem;
        }

        .input-group input[type="number"] {
            width: 80%;
            max-width: 300px;
            padding: 12px 18px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.6);
            color: var(--text); /* Uses the --text variable */
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
        }
        body.dark .input-group input[type="number"] {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text); /* Uses the --text variable */
        }

        .input-group input[type="number"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.3);
            background-color: rgba(255, 255, 255, 0.8);
        }
        body.dark .input-group input[type="number"]:focus {
            background-color: rgba(0, 0, 0, 0.5);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .button-group button {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            background-color: var(--primary);
            color: #fff;
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
        }

        .button-group button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
        }

        .button-group button:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(124, 58, 237, 0.2);
        }

        .button-group button.bg-gray-400 {
            background-color: #9ca3af;
            box-shadow: 0 4px 15px rgba(156, 163, 175, 0.3);
        }
        .button-group button.bg-gray-400:hover {
            background-color: #6b7280;
            box-shadow: 0 6px 20px rgba(156, 163, 175, 0.4);
        }

        .button-group button.bg-red-500 {
            background-color: #ef4444;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        .button-group button.bg-red-500:hover {
            background-color: #dc2626;
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .result-section {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            margin-top: 30px;
            text-align: center;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
        }

        .result-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .hidden {
            display: none;
        }

        .chart-container-with-button {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 400px;
            margin: 20px auto;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            padding: 10px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chart-container-with-button canvas {
            width: 100% !important;
            height: 100% !important;
        }

        #toggleChartTypeBtn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--accent);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(56, 189, 248, 0.3);
            transition: transform 0.2s ease, background-color 0.2s ease;
            z-index: 10;
        }

        #toggleChartTypeBtn:hover {
            transform: scale(1.1);
            background-color: var(--primary-dark);
        }

        .info-and-tips-container {
            background: rgba(255, 255, 255, 0.15);
            border-left: 5px solid var(--accent);
            border-radius: 8px;
            padding: 15px 20px;
            margin: 15px auto;
            max-width: 600px;
            text-align: left;
            font-size: 1.05rem;
            color: var(--text); /* Uses the --text variable */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        body.dark .info-and-tips-container {
            background: rgba(0, 0, 0, 0.2);
            border-left-color: var(--accent);
        }

        .impact-stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
            padding: 10px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.dark .stat-box {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-box:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 25px rgba(31, 38, 135, 0.25);
        }

        .stat-box h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 10px;
        }
        body.dark .stat-box h3 {
            color: var(--accent);
        }

        .stat-box .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text); /* Changed to use --text variable */
            text-shadow: 0 0 8px var(--chart-glow-color);
            margin-bottom: 5px;
        }

        .stat-box .description {
            font-size: 0.9rem;
            color: var(--text); /* Uses the --text variable */
            text-align: center;
        }

        #shareResultsButton {
            background-color: var(--olive-light);
            color: #fff;
            box-shadow: 0 4px 15px rgba(107, 142, 35, 0.3);
        }

        #shareResultsButton:hover {
            background-color: var(--olive-dark);
            box-shadow: 0 6px 20px rgba(107, 142, 35, 0.4);
        }

        footer {
            background-color: var(--footer-bg);
            padding: 20px;
            text-align: center;
            font-size: 0.9rem;
            color: #666; /* Specific color, not `--text` */
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.05);
            margin: 40px auto 0 auto; /* Centered horizontally with auto margins */
            max-width: 900px; /* Max width for footer content */
            width: 100%;
            position: relative;
        }

        body.dark footer {
            background-color: var(--footer-bg);
            color: #aaa; /* Specific color for dark footer */
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .hidden-link {
            cursor: pointer;
            color: var(--text); /* Uses the --text variable */
            transition: color 0.3s ease;
        }

        .hidden-link:hover {
            color: var(--primary);
        }
        body.dark .hidden-link {
            color: #aaa; /* Specific color for dark theme hidden link */
        }
        body.dark .hidden-link:hover {
            color: var(--accent);
        }

        .like-card {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: linear-gradient(45deg, #ff6b6b, #ffe66d);
            color: white;
            padding: 10px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s ease;
            z-index: 100;
        }

        .like-card.visible {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .like-card .heart-icon {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .message-box-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .message-box {
            background: var(--background);
            color: var(--text); /* Uses the --text variable */
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            max-width: 400px;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }

        .message-box-overlay.visible .message-box {
            transform: translateY(0);
            opacity: 1;
        }

        .message-box h3 {
            font-size: 1.8rem;
            color: var(--primary-dark);
            margin-bottom: 15px;
        }
        body.dark .message-box h3 {
            color: var(--accent);
        }

        .message-box p {
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .message-box button {
            background-color: var(--accent);
            color: #fff;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .message-box button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Loading Spinner CSS */
        .loading-spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001; /* Higher than message box */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .loading-spinner-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid var(--accent);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="light">
    <nav class="nav__cont">
        <ul class="nav">
            <li class="nav__items">
                <a href="index.html" data-icon="🏠">Home</a>
            </li>
            <li class="nav__items">
                <a href="Plasticcalc.html" data-icon="🗑️">Plastic Calculator</a>
            </li>
            <li class="nav__items">
                <a href="calculator.html" data-icon="🧮">Carbon Calculator</a>
            </li>
            <li class="nav__items">
                <a href="eleccalc.html" data-icon="⚡">Electricity Calculator</a>
            </li>
            <li class="nav__items">
                <a href="watercalc.html" data-icon="💧">Water Calculator</a>
            </li>
            <li class="nav__items">
                <a href="ecotech.html" data-icon="✨">Our Values</a>
            </li>
            <li class="nav__items">
                <a href="change.html" data-icon="💪">Forces of Change</a>
            </li>
        </ul>
    </nav>

    <div id="contentWrapper">
        <header>
            <img src="https://placehold.co/120x120/333333/FFFFFF?text=EcoTech+Logo" alt="EcoTech Logo" class="logo" onclick="window.location.href='index.html';" title="Home" onerror="this.onerror=null;this.src='https://placehold.co/120x120/333333/FFFFFF?text=EcoTech+Logo';">
            <h1>💧 Water Consumption Calculator 🌊</h1>
            <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
                <span id="theme-icon">☀️</span>
            </button>
        </header>

        <main>
            <section class="calculator fade-section">
                <h2>Estimate Your Water Usage 💧</h2>
                <div class="input-group">
                    <label for="monthlyWaterBill">💰 Average Monthly Water Bill (₹)</label>
                    <input type="number" id="monthlyWaterBill" placeholder="e.g., 500">
                </div>
                <div class="input-group">
                    <label for="waterCostPerLiter">💧 Water Cost per Liter (₹)</label>
                    <input type="number" id="waterCostPerLiter" placeholder="e.g., 0.05">
                </div>
                <div class="input-group">
                    <label for="peopleInHousehold">👨‍👩‍👧‍👦 Number of People in Household</label>
                    <input type="number" id="peopleInHousehold" placeholder="e.g., 4">
                </div>
                <div class="input-group">
                    <label for="dailyShowers">🚿 Average Daily Showers (per person)</label>
                    <input type="number" id="dailyShowers" placeholder="e.g., 1">
                </div>
                <div class="input-group">
                    <label for="showerDuration">⏱️ Average Shower Duration (minutes)</label>
                    <input type="number" id="showerDuration" placeholder="e.g., 8">
                </div>
                <div class="input-group">
                    <label for="washingMachineLoads">🧺 Weekly Washing Machine Loads</label>
                    <input type="number" id="washingMachineLoads" placeholder="e.g., 3">
                </div>
                <div class="input-group">
                    <label for="dishwasherLoads">🍽️ Weekly Dishwasher Loads</label>
                    <input type="number" id="dishwasherLoads" placeholder="e.g., 2">
                </div>
                <div class="input-group">
                    <label for="gardenWateringHours">🌳 Weekly Garden Watering (hours)</label>
                    <input type="number" id="gardenWateringHours" placeholder="e.g., 1">
                </div>
                <div class="button-group">
                    <button id="calculateButton">Calculate ✨</button>
                    <button id="resetButton" class="bg-gray-400 hover:bg-gray-500">Reset 🔄</button>
                    <button id="clearAllButton" class="bg-red-500 hover:bg-red-600">Clear All 🗑️</button>
                </div>

                <div id="result" class="result-section hidden">
                    <h3 class="text-xl font-semibold mt-8 mb-4 text-center">📈 Your Water Usage Breakdown</h3>
                    <div class="chart-container-with-button">
                        <button id="toggleChartTypeBtn" onclick="toggleChartType()" title="Switch Graphs">📊</button>
                        <canvas id="waterChart"></canvas>
                    </div>

                    <div id="waterSummary" class="info-and-tips-container">
                    </div>
                    <div id="waterTips" class="info-and-tips-container mt-4">
                    </div>

                    <div class="impact-stats-container">
                        <div class="stat-box">
                            <h3>💧 Annual Consumption (Liters)</h3>
                            <div class="value" id="annualConsumptionValue">0</div>
                            <div class="description">estimated yearly water use 🌊</div>
                        </div>
                        <div class="stat-box">
                            <h3>🗓️ Daily Consumption (Liters)</h3>
                            <div class="value" id="dailyConsumptionValue">0</div>
                            <div class="description">estimated daily water use 🚿</div>
                        </div>
                        <div class="stat-box">
                            <h3>💲 Estimated Annual Cost (₹)</h3>
                            <div class="value" id="totalCostValue">0</div>
                            <div class="description">approximate yearly water bill 💸</div>
                        </div>
                        <div class="stat-box">
                            <h3>🌍 Carbon Footprint (kg CO2e)</h3>
                            <div class="value" id="carbonFootprintValue">0</div>
                            <div class="description">from heating & treatment 💨</div>
                        </div>
                        <div class="stat-box">
                            <h3>💰 Potential Annual Savings (₹)</h3>
                            <div class="value" id="potentialSavingsValue">0</div>
                            <div class="description">by reducing water usage 💧</div>
                        </div>
                    </div>
                    <div class="button-group mt-6">
                        <button id="shareResultsButton">Share Your Results 🔗</button>
                    </div>
                </div>
            </section>
        </main>

        <footer class="bg-transparent py-6 text-center">
            <span id="footerText" class="hidden-link">© KNIGHTS</span>
            <div id="likeCard" class="like-card">
                <span class="heart-icon">❤️</span>
                <span>I like u</span>
            </div>
        </footer>
    </div>

    <div id="messageBoxOverlay" class="message-box-overlay">
        <div class="message-box">
            <h3 id="messageBoxTitle"></h3>
            <p id="messageBoxContent"></p>
            <button onclick="hideMessageBox()">OK</button>
        </div>
    </div>

    <div id="loadingSpinnerOverlay" class="loading-spinner-overlay">
        <div class="spinner"></div>
    </div>

    <script>
        // Theme Toggle Logic
        const body = document.body;
        const themeToggle = document.getElementById('themeToggle');
        const themeToggleIcon = document.getElementById('theme-icon');

        let isDark = false;

        // Function to initialize theme based on local storage
        function initializeTheme() {
            if (localStorage.getItem('theme') === 'dark') {
                isDark = true;
                body.classList.add('dark');
                if (themeToggleIcon) {
                    themeToggleIcon.textContent = '🌑'; // Dark mode icon
                }
            } else {
                if (themeToggleIcon) {
                    themeToggleIcon.textContent = '☀️'; // Light mode icon
                }
            }
        }

        // Function to toggle theme
        function toggleTheme() {
            isDark = !isDark;
            body.classList.toggle('dark', isDark);
            body.classList.toggle('light', !isDark);
            themeToggleIcon.textContent = isDark ? '🌑' : '☀️'; // Update icon
            localStorage.setItem('theme', isDark ? 'dark' : 'light'); // Save theme preference

            // If chart exists, update its colors for the new theme
            if (waterChart && lastCalculatedData) {
                const rootStyles = getComputedStyle(document.documentElement);
                const neonBlue = rootStyles.getPropertyValue('--neon-blue').trim();
                const neonPurple = rootStyles.getPropertyValue('--neon-purple').trim();
                const neonGreen = rootStyles.getPropertyValue('--neon-green').trim();
                const neonYellow = rootStyles.getPropertyValue('--neon-yellow').trim();
                const textColor = rootStyles.getPropertyValue('--text').trim();
                const glassBgColor = rootStyles.getPropertyValue('--glass-bg').trim();
                updateChart(lastCalculatedData, chartTypes[currentChartTypeIndex], neonBlue, neonPurple, neonGreen, neonYellow, textColor, glassBgColor);
            }
        }
        // Initialize theme when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeTheme);


        // DOM Elements
        const logo = document.querySelector('.logo');
        const sections = document.querySelectorAll('.fade-section');
        const calculateButton = document.getElementById('calculateButton');
        const resetButton = document.getElementById('resetButton');
        const clearAllButton = document.getElementById('clearAllButton');
        const resultSection = document.getElementById('result');
        const waterSummaryDiv = document.getElementById('waterSummary');
        const waterTipsDiv = document.getElementById('waterTips');
        const annualConsumptionValue = document.getElementById('annualConsumptionValue');
        const dailyConsumptionValue = document.getElementById('dailyConsumptionValue');
        const totalCostValue = document.getElementById('totalCostValue');
        const carbonFootprintValue = document.getElementById('carbonFootprintValue');
        const potentialSavingsValue = document.getElementById('potentialSavingsValue');
        const toggleChartTypeBtn = document.getElementById('toggleChartTypeBtn');
        const shareResultsButton = document.getElementById('shareResultsButton');
        const footerText = document.getElementById('footerText');
        const likeCard = document.getElementById('likeCard');

        // Message Box Elements
        const messageBoxOverlay = document.getElementById('messageBoxOverlay');
        const messageBoxTitle = document.getElementById('messageBoxTitle');
        const messageBoxContent = document.getElementById('messageBoxContent');

        // Loading Spinner Elements
        const loadingSpinnerOverlay = document.getElementById('loadingSpinnerOverlay');

        // Chart Variables
        let waterChart = null;
        let currentChartTypeIndex = 0;
        const chartTypes = ['doughnut', 'bar', 'line'];
        let lastCalculatedData = null; // Stores the last calculated data for chart updates

        // Default Constants for Water Calculations
        const DEFAULT_WATER_COST_PER_LITER = 0.05; // ₹/liter (example)
        const DEFAULT_PEOPLE_IN_HOUSEHOLD = 1;
        const DEFAULT_SHOWER_FLOW_RATE = 9.5; // liters per minute
        const DEFAULT_WASHING_MACHINE_LOAD_VOLUME = 60; // liters per load
        const DEFAULT_DISHWASHER_LOAD_VOLUME = 12; // liters per load
        const DEFAULT_GARDEN_WATERING_FLOW_RATE = 750; // liters per hour (12.5 liters/min)

        // Carbon Footprint Constants (simplified assumptions)
        const ENERGY_TO_HEAT_WATER_PER_LITER_KWH = 0.035; // kWh per liter for heating by ~30C
        const CARBON_INTENSITY_OF_ELECTRICITY_KG_CO2_PER_KWH = 0.8; // kg CO2e per kWh (example for India)
        const CARBON_FROM_WATER_TREATMENT_PER_LITER_KG_CO2 = 0.00003; // kg CO2e per liter (very small, general factor)
        const PERCENT_WATER_HEATED = 0.5; // 50% of water is assumed to be heated (showers, dishwasher, some washing machine)

        // Function to display a custom message box
        function showMessageBox(title, message) {
            messageBoxTitle.textContent = title;
            messageBoxContent.textContent = message;
            messageBoxOverlay.classList.add('visible');
        }

        // Function to hide the custom message box
        function hideMessageBox() {
            messageBoxOverlay.classList.remove('visible');
        }

        // Function to show the loading spinner
        function showLoadingSpinner() {
            loadingSpinnerOverlay.classList.add('visible');
            // Ensure display is block/flex when visible
            loadingSpinnerOverlay.style.display = 'flex';
        }

        // Function to hide the loading spinner
        function hideLoadingSpinner() {
            loadingSpinnerOverlay.classList.remove('visible');
            // Hide completely after transition
            setTimeout(() => {
                loadingSpinnerOverlay.style.display = 'none';
            }, 300); // Match CSS transition duration
        }

        // Event Listeners
        logo.addEventListener('click', () => {
            window.location.href = 'index.html'; // Navigate to home page
        });

        // Intersection Observer for fade-in sections
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.fade-section').forEach((section) => {
            observer.observe(section);
        });

        // Button Event Listeners
        calculateButton.addEventListener('click', calculateWaterConsumption);
        resetButton.addEventListener('click', resetCalculator);
        clearAllButton.addEventListener('click', clearAllInputs);
        toggleChartTypeBtn.addEventListener('click', toggleChartType);
        shareResultsButton.addEventListener('click', shareResults);

        // Main calculation function
        function calculateWaterConsumption() {
            showLoadingSpinner(); // Show loading spinner

            setTimeout(() => { // Simulate a delay for calculation
                // Get input values, using defaults if empty or invalid
                const monthlyWaterBill = parseFloat(document.getElementById('monthlyWaterBill').value) || 0;
                const waterCostPerLiter = parseFloat(document.getElementById('waterCostPerLiter').value) || DEFAULT_WATER_COST_PER_LITER;
                const peopleInHousehold = parseInt(document.getElementById('peopleInHousehold').value) || DEFAULT_PEOPLE_IN_HOUSEHOLD;
                const dailyShowers = parseFloat(document.getElementById('dailyShowers').value) || 0;
                const showerDuration = parseFloat(document.getElementById('showerDuration').value) || 0;
                // const toiletFlushes = parseFloat(document.getElementById('toiletFlushes').value) || 0; // Removed
                const washingMachineLoads = parseFloat(document.getElementById('washingMachineLoads').value) || 0;
                const dishwasherLoads = parseFloat(document.getElementById('dishwasherLoads').value) || 0;
                const gardenWateringHours = parseFloat(document.getElementById('gardenWateringHours').value) || 0;

                // Input validation
                if (monthlyWaterBill < 0 || waterCostPerLiter <= 0 || peopleInHousehold <= 0 || dailyShowers < 0 || showerDuration < 0 || washingMachineLoads < 0 || dishwasherLoads < 0 || gardenWateringHours < 0) {
                    hideLoadingSpinner();
                    showMessageBox("Invalid Input", "Please enter valid non-negative values. Water cost per liter, and number of people must be greater than zero.");
                    return;
                }

                // Calculations based on activities (daily consumption per household)
                const showersDailyLiters = dailyShowers * showerDuration * DEFAULT_SHOWER_FLOW_RATE * peopleInHousehold;
                // const toiletFlushesDailyLiters = toiletFlushes * DEFAULT_TOILET_FLUSH_VOLUME * peopleInHousehold; // Removed
                const washingMachineDailyLiters = (washingMachineLoads * DEFAULT_WASHING_MACHINE_LOAD_VOLUME) / 7; // Convert weekly to daily
                const dishwasherDailyLiters = (dishwasherLoads * DEFAULT_DISHWASHER_LOAD_VOLUME) / 7; // Convert weekly to daily
                const gardenWateringDailyLiters = (gardenWateringHours * DEFAULT_GARDEN_WATERING_FLOW_RATE) / 7; // Convert weekly to daily

                const calculatedDailyConsumptionLiters = showersDailyLiters + washingMachineDailyLiters + dishwasherDailyLiters + gardenWateringDailyLiters; // toiletFlushesDailyLiters removed
                const calculatedAnnualConsumptionLiters = calculatedDailyConsumptionLiters * 365;

                // Calculate annual consumption based on bill if provided, otherwise use calculated values
                let annualConsumptionLiters;
                if (monthlyWaterBill > 0 && waterCostPerLiter > 0) {
                    annualConsumptionLiters = (monthlyWaterBill / waterCostPerLiter) * 12;
                } else {
                    annualConsumptionLiters = calculatedAnnualConsumptionLiters;
                }

                const dailyConsumptionLiters = annualConsumptionLiters / 365;

                // Estimated Annual Cost
                const estimatedAnnualCost = annualConsumptionLiters * waterCostPerLiter;

                // Carbon Footprint Calculation
                const heatedWaterUsageLiters = (showersDailyLiters + washingMachineDailyLiters + dishwasherDailyLiters) * PERCENT_WATER_HEATED;
                const annualHeatedWaterUsageLiters = heatedWaterUsageLiters * 365;

                const energyForHeatingKWH = annualHeatedWaterUsageLiters * ENERGY_TO_HEAT_WATER_PER_LITER_KWH;
                const carbonFromHeating = energyForHeatingKWH * CARBON_INTENSITY_OF_ELECTRICITY_KG_CO2_PER_KWH;

                const carbonFromTreatment = annualConsumptionLiters * CARBON_FROM_WATER_TREATMENT_PER_LITER_KG_CO2;
                const totalCarbonFootprint = carbonFromHeating + carbonFromTreatment;

                // Potential Annual Savings (example: 10% reduction)
                const potentialAnnualSavings = estimatedAnnualCost * 0.10; // 10% reduction as a simple example

                // Store data for chart updates
                lastCalculatedData = {
                    annualConsumption: annualConsumptionLiters,
                    dailyConsumption: dailyConsumptionLiters,
                    totalCost: estimatedAnnualCost,
                    carbonFootprint: totalCarbonFootprint,
                    potentialSavings: potentialAnnualSavings
                };

                // Update UI with results
                waterSummaryDiv.innerHTML = `
                    <p>Your estimated annual water consumption is: <strong>${annualConsumptionLiters.toFixed(2)} Liters</strong>.</p>
                    <p>This translates to approximately <strong>${dailyConsumptionLiters.toFixed(2)} Liters per day</strong>.</p>
                    <p>The estimated annual cost for your water usage is: <strong>₹${estimatedAnnualCost.toFixed(2)}</strong>.</p>
                    <p>Your estimated annual carbon footprint from water usage (heating & treatment) is: <strong>${totalCarbonFootprint.toFixed(2)} kg CO2e</strong>.</p>
                    <p>By implementing water-saving habits, you could potentially save: <strong>₹${potentialAnnualSavings.toFixed(2)} annually</strong>.</p>
                `;
                waterSummaryDiv.classList.remove('hidden');

                const tips = [
                    "Take shorter showers.",
                    "Turn off the tap while brushing teeth or washing dishes.",
                    "Fix leaky faucets and running toilets promptly.",
                    "Only run washing machines and dishwashers with full loads.",
                    "Install low-flow showerheads and aerators on faucets.",
                    "Collect rainwater for garden use.",
                    "Water your garden in the early morning or late evening to reduce evaporation.",
                    "Consider a dual-flush toilet.",
                    "Don't use the toilet as a wastebasket.",
                    "Thaw frozen food in the refrigerator instead of under running water."
                ];
                const randomTip = tips[Math.floor(Math.random() * tips.length)];
                waterTipsDiv.textContent = `💡 Water Saving Tip: ${randomTip}`;
                waterTipsDiv.classList.remove('hidden');

                annualConsumptionValue.textContent = annualConsumptionLiters.toFixed(2);
                dailyConsumptionValue.textContent = dailyConsumptionLiters.toFixed(2);
                totalCostValue.textContent = estimatedAnnualCost.toFixed(2);
                carbonFootprintValue.textContent = totalCarbonFootprint.toFixed(2);
                potentialSavingsValue.textContent = potentialAnnualSavings.toFixed(2);

                resultSection.classList.remove('hidden');
                void resultSection.offsetWidth; // Trigger reflow for animation
                resultSection.classList.add('visible');

                // Update chart with new data
                const rootStyles = getComputedStyle(document.documentElement);
                const neonBlue = rootStyles.getPropertyValue('--neon-blue').trim();
                const neonPurple = rootStyles.getPropertyValue('--neon-purple').trim();
                const neonGreen = rootStyles.getPropertyValue('--neon-green').trim();
                const neonYellow = rootStyles.getPropertyValue('--neon-yellow').trim();
                const textColor = rootStyles.getPropertyValue('--text').trim();
                const glassBgColor = rootStyles.getPropertyValue('--glass-bg').trim();
                updateChart(lastCalculatedData, chartTypes[currentChartTypeIndex], neonBlue, neonPurple, neonGreen, neonYellow, textColor, glassBgColor);
                hideLoadingSpinner(); // Hide loading spinner after calculations and chart update
            }, 1000); // 1-second delay
        }

        // Function to reset the calculator to initial state
        function resetCalculator() {
            if (waterChart) {
                waterChart.destroy();
                waterChart = null;
            }
            lastCalculatedData = null;
            waterSummaryDiv.textContent = '';
            waterTipsDiv.textContent = '';
            annualConsumptionValue.textContent = '0';
            dailyConsumptionValue.textContent = '0';
            totalCostValue.textContent = '0';
            carbonFootprintValue.textContent = '0';
            potentialSavingsValue.textContent = '0';

            resultSection.classList.remove('visible');
            resultSection.classList.add('hidden');
        }

        // Function to clear all input fields and reset calculator
        function clearAllInputs() {
            document.getElementById('monthlyWaterBill').value = '';
            document.getElementById('waterCostPerLiter').value = '';
            document.getElementById('peopleInHousehold').value = '';
            document.getElementById('dailyShowers').value = '';
            document.getElementById('showerDuration').value = '';
            // document.getElementById('toiletFlushes').value = ''; // Removed
            document.getElementById('washingMachineLoads').value = '';
            document.getElementById('dishwasherLoads').value = '';
            document.getElementById('gardenWateringHours').value = '';

            resetCalculator(); // Call reset to clear results and chart
        }

        // Function to toggle chart type (Doughnut, Bar, Line)
        function toggleChartType() {
            currentChartTypeIndex = (currentChartTypeIndex + 1) % chartTypes.length;
            if (lastCalculatedData) { // Only update if there's data
                const rootStyles = getComputedStyle(document.documentElement);
                const neonBlue = rootStyles.getPropertyValue('--neon-blue').trim();
                const neonPurple = rootStyles.getPropertyValue('--neon-purple').trim();
                const neonGreen = rootStyles.getPropertyValue('--neon-green').trim();
                const neonYellow = rootStyles.getPropertyValue('--neon-yellow').trim();
                const textColor = rootStyles.getPropertyValue('--text').trim();
                const glassBgColor = rootStyles.getPropertyValue('--glass-bg').trim();
                updateChart(lastCalculatedData, chartTypes[currentChartTypeIndex], neonBlue, neonPurple, neonGreen, neonYellow, textColor, glassBgColor);
            }
        }

        // Function to update or create the Chart.js graph
        function updateChart(data, type, neonBlue, neonPurple, neonGreen, neonYellow, textColor, glassBgColor) {
            const ctx = document.getElementById('waterChart').getContext('2d');

            // Destroy existing chart instance if it exists
            if (waterChart) {
                waterChart.destroy();
            }

            // Define chart labels and data values
            const chartLabels = ['Annual Consumption (Liters)', 'Estimated Annual Cost (₹)', 'Carbon Footprint (kg CO2e)', 'Potential Savings (₹)'];
            const chartDataValues = [data.annualConsumption, data.totalCost, data.carbonFootprint, data.potentialSavings];

            const chartData = {
                labels: chartLabels,
                datasets: [{
                    label: 'Water Metrics',
                    data: chartDataValues,
                    backgroundColor: [
                        neonBlue,
                        neonGreen,
                        neonPurple,
                        neonYellow
                    ],
                    borderColor: [
                        neonBlue.replace('0.8)', '1)'),
                        neonGreen.replace('0.8)', '1)'),
                        neonPurple.replace('0.8)', '1)'),
                        neonYellow.replace('0.8)', '1)')
                    ],
                    borderWidth: 2,
                    fill: type === 'line' ? true : false, // Fill area under line chart
                    tension: type === 'line' ? 0.4 : 0 // Smoothness for line chart
                }]
            };

            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        display: type !== 'doughnut', // Hide Y-axis for doughnut chart
                        title: {
                            display: type !== 'doughnut',
                            text: 'Value',
                            color: textColor
                        },
                        ticks: {
                            color: textColor
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    x: {
                        display: type !== 'doughnut', // Hide X-axis for doughnut chart
                        ticks: {
                            color: textColor
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: textColor
                        }
                    },
                    title: {
                        display: false, // Title is in H3 above chart
                        text: 'Your Water Usage Breakdown',
                        font: {
                            size: 18,
                            color: textColor
                        },
                        color: textColor
                    },
                    tooltip: {
                        backgroundColor: glassBgColor,
                        titleColor: textColor,
                        bodyColor: textColor,
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1,
                        cornerRadius: 8,
                        displayColors: true
                    }
                }
            };

            // Create new chart instance
            waterChart = new Chart(ctx, {
                type: type,
                data: chartData,
                options: chartOptions
            });
        }

        // Function to share results (copies to clipboard)
        function shareResults() {
            if (!lastCalculatedData) {
                showMessageBox("No Results", "Please calculate your water consumption first!");
                return;
            }
            const annualConsumptionFormatted = lastCalculatedData.annualConsumption.toFixed(2);
            const totalCostFormatted = lastCalculatedData.totalCost.toFixed(2);
            const carbonFootprintFormatted = lastCalculatedData.carbonFootprint.toFixed(2);
            const potentialSavingsFormatted = lastCalculatedData.potentialSavings.toFixed(2);

            const message = `My estimated annual water consumption is ${annualConsumptionFormatted} Liters, costing approximately ₹${totalCostFormatted}. This results in a carbon footprint of ${carbonFootprintFormatted} kg CO2e. I could save ₹${potentialSavingsFormatted} annually! 💧 #EcoTech #WaterConservation`;

            if (document.execCommand) {
                const textarea = document.createElement('textarea');
                textarea.value = message;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showMessageBox("Results Copied!", "Your water consumption summary has been copied to your clipboard. Share it with others!");
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    showMessageBox("Copy Failed", "Could not copy to clipboard. Please copy the text manually:\n\n" + message);
                }
                document.body.removeChild(textarea);
            } else {
                showMessageBox("Copy Not Supported", "Your browser does not support automatic clipboard copying. Please copy the text manually:\n\n" + message);
            }
        }

        // Footer "Like" card functionality
        footerText.addEventListener('click', () => {
            likeCard.classList.add('visible');
            setTimeout(() => {
                likeCard.classList.remove('visible');
            }, 3000);
        });
    </script>
</body>
</html>
